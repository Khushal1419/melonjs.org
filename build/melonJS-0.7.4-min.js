/*!
 * MelonJS Game Engine
 * or... my humble attempt to create a game/app framework :)
 *
 * Minified version
 *
 * Copyright (C) 2011, Olivier BIOT
 * http://olivierbiot.wordpress.com/
 * 
 * melonJS is licensed under a Creative Commons 
 * Attribution-NonCommercial-NoDerivs 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc-nd/3.0/
 *
 * Author:Olivier Biot
 * Date:March 2011
 */
(function(h,d){var o=h.document;h.me={mod:"melonJS",nocache:"",sys:{ua:navigator.userAgent.toLowerCase(),sound:false,storage:false,gyro:(h.DeviceMotionEvent!==d),fps:60,interpolation:false,scale:1},debug:{displayFPS:false,renderHitBox:false},audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,XMLParser:null,loadingScreen:null};var l=false,m=false,s=[];function e(){if(!m){if(!o.body){setTimeout(e,10)}else{m=true;for(var t=0;t<s.length;t++){s[t].call(h,[])}s=[]}}}function i(){if(l){return}l=true;if(o.addEventListener){o.addEventListener("DOMContentLoaded",e,false)}h.addEventListener("load",e,false)}onReady=function(t){i();if(m){t.call(h,[])}else{s.push(function(){return t.call(h,[])})}return this};i();if(!Function.bind){Function.prototype.bind=function(u){var t=this;return function(){return t.apply(u,arguments)}}}Array.prototype.remove=function(t){if(this.indexOf(t)!==-1){this.splice(this.indexOf(t),1);return true}else{return false}};String.prototype.trim=function(){return(this.replace(/^\s+/,"")).replace(/\s+$/,"")};String.prototype.isNumeric=function(){return(this!=null&&!isNaN(this)&&this.trim()!="")};String.prototype.isBoolean=function(){return(this!=null&&("true"==this.trim()||"false"==this.trim()))};String.prototype.contains=function(t){return(this.match(t)==t)};function f(){var t={xmlDoc:null,parser:null,parseFromString:function(u){if(h.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(u,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(u)}if(xmlDoc==null){console.log("xml "+xmlDoc+" not found!")}},getFirstElementByTagName:function(u){return xmlDoc?xmlDoc.getElementsByTagName(u)[0]:null},getAllTagElements:function(){return xmlDoc?xmlDoc.getElementsByTagName("*"):null},getStringAttribute:function(v,x,w){var u=v.getAttribute(x);return u?u.trim().toLowerCase():w},getIntAttribute:function(v,x,w){var u=this.getStringAttribute(v,x,w);return u?parseInt(u):w},getFloatAttribute:function(v,x,w){var u=this.getStringAttribute(v,x,w);return u?parseFloat(u):w},getBooleanAttribute:function(v,x,w){var u=this.getStringAttribute(v,x,w);return u?(u=="true"):w},free:function(){xmlDoc=null;parser=null}};return t}function b(){if(o.addEventListener){o.removeEventListener("DOMContentLoaded",e,false)}else{h.removeEventListener("load",e,false)}var t=o.createElement("audio");me.utils.setNocache(o.location.href.match(/\?nocache/));if(t.canPlayType){me.audio.capabilities.mp3=("no"!=t.canPlayType("audio/mpeg"))&&(""!=t.canPlayType("audio/mpeg"));me.audio.capabilities.ogg=("no"!=t.canPlayType('audio/ogg; codecs="vorbis"'))&&(""!=t.canPlayType('audio/ogg; codecs="vorbis"'));me.audio.capabilities.wav=("no"!=t.canPlayType('audio/wav; codecs="1"'))&&(""!=t.canPlayType('audio/wav; codecs="1"'));me.sys.sound=me.audio.capabilities.mp3||me.audio.capabilities.ogg||me.audio.capabilities.wav}if((me.sys.ua.search("iphone")>-1)||(me.sys.ua.search("ipod")>-1)||(me.sys.ua.search("ipad")>-1)||(me.sys.ua.search("android")>-1)){me.sys.sound=false}me.timer.init();me.XMLParser=new f();me.loadingScreen=new me.DefaultLoadingScreen();me.state.init();me.entityPool.init();me.levelDirector.reset()}h.onReady(function(){b()});function q(t,v,u){if(t===d){return}this.pos=new me.Vector2d(t,v);this.scale=new me.Vector2d(1,1);this.lastflipX=false;this.lastflipY=false;this.z=0;this.currentSpriteOff=0;this.spriteWidth=0;this.spriteHeight=0;this.displayWidth=0;this.displayHeight=0;this.scaleFlag=false;this.autodestroy=true;this.visible=true;if(u!=d){this.image=u;this.displayWidth=this.spriteWidth=this.image.width;this.displayHeight=this.spriteHeight=this.image.height}this.collisionBox=new me.Rectangle(this.pos,this.displayWidth,this.displayHeight)}q.prototype.flipX=function(t){if(t!=this.lastflipX){this.lastflipX=t;if(t){this.scale.x=this.scale.x>0?-this.scale.x:this.scale.x}else{this.scale.x=this.scale.x<0?-this.scale.x:this.scale.x}this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipX(this.spriteWidth)}};q.prototype.flipY=function(t){if(t!=this.lastflipY){this.lastflipY=t;if(t){this.scale.y=this.scale.y>0?-this.scale.y:this.scale.y}else{this.scale.y=this.scale.y<0?-this.scale.y:this.scale.y}this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipY(this.spriteHeight)}};q.prototype.update=function(){return false};q.prototype.draw=function(u){var t=this.pos.x-me.game.viewport.pos.x,v=this.pos.y-me.game.viewport.pos.y;if(this.scaleFlag){u.scale(this.scale.x,this.scale.y);t=(t*this.scale.x)-(this.scale.x<0?this.spriteWidth:0);v=(v*this.scale.y)-(this.scale.y<0?this.spriteHeight:0)}u.drawImage(this.image,this.currentSpriteOff,0,this.spriteWidth,this.spriteHeight,t,v,this.displayWidth,this.displayHeight);if(this.scaleFlag){u.setTransform(1,0,0,1,0,0)}if(me.debug.renderHitBox){this.collisionBox.draw(u)}};q.prototype.destroy=function(){this.onDestroyEvent();if(this.autodestroy){this.image=null;me.game.remove(this)}};q.prototype.onDestroyEvent=function(){};function j(t,w,v,u){if(t==d){return}q.call(this,t,w,v);this.type=0;this.currentSprite=0;this.collidable=false;this.fpscount=0;this.animationspeed=me.sys.fps/10;if(this.image!=d){this.displayWidth=this.spriteWidth=u||this.image.width;this.spritecount=~~(this.image.width/this.spriteWidth)}else{this.spritecount=1}this.collisionBox.set(this.pos,this.displayWidth,this.displayHeight);this.currentSpriteOff=0}j.prototype=new q();j.prototype.setCurrentSprite=function(t){this.currentSprite=t;this.currentSpriteOff=this.spriteWidth*t};j.prototype.updateColRect=function(t,u,z,v){this.collisionBox.adjustSize(t,u,z,v)};j.prototype.update=function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++this.currentSprite<this.spritecount?this.currentSprite:0);this.fpscount=0;return true}return false};j.prototype.checkCollision=function(u){var t=this.collisionBox.collideVsAABB(u.collisionBox);t.type=me.game.NO_OBJECT;if(t.x!=0||t.y!=0){this.onCollision(t,u);t.type=this.type}return t};j.prototype.onCollision=function(t){if(this.collidable&&(this.type==me.game.COLLECTABLE_OBJECT)){this.destroy()}};var k=(function(){var A={};var E=0;var B=0;var D=null;var z=[];var t=0;var C=false;var w=true;var v=false;var u=[];A.viewport=null;A.HUD=null;A.collisionMap=null;A.currentLevel=null;A.NO_OBJECT=0;A.ENEMY_OBJECT=1;A.COLLECTABLE_OBJECT=2;A.ACTION_OBJECT=3;A.init=function(G,I,H,F){if(!v){G=G||0;I=I||0;var H=H||me.video.getWidth();var F=F||me.video.getHeight();spriteCanvasSurface=me.video.createCanvasSurface(H,F);A.viewport=new me.Viewport(0,0,H,F);D=me.video.getScreenFrameBuffer();v=true}};A.reset=function(){if(!v){A.init()}A.removeAll();if(A.viewport){A.viewport.reset()}w=true};A.loadTMXLevel=function(G){A.currentLevel=G;A.collisionMap=A.currentLevel.getLayerByName("collision");if(!A.collisionMap||!A.collisionMap.isCollisionMap){alert("WARNING : no collision map detected")}A.currentLevel.addTo(me.game);A.viewport.setBounds(A.currentLevel.realwidth,A.currentLevel.realheight);var x=A.currentLevel.getObjectGroups();for(var F=0;F<x.length;F++){for(var y=0;y<x[F].objects.length;y++){A.addEntity(x[F].objects[y],x[F].z)}}A.sort()};A.addEntity=function(x,y){A.add(me.entityPool.newIstanceOf(x),y)};A.addHUD=function(F,J,G,I,H){if(A.HUD==null){A.HUD=new me.HUD_Object(F,J,G,I,H)}};A.disableHUD=function(){if(A.HUD!=null){A.HUD=null}};A.add=function(x,y){x.z=(y)?y:x.z;z.push(x);if(x.mouseEvent){u.push(x)}t=z.length};A.mouseEvent=function(F,H){for(var G=u.length;G--;){u[G].mouseEvent(F,H)}};A.update=function(){me.timer.update();for(var x=t,y;x--,y=z[x];){if(y.update()){w=true}if(y.isEntity&&!y.flickering){y.visible=A.viewport.checkAxisAligned(y.collisionBox)}}};A.remove=function(x){z.splice(z.indexOf(x),1);if(x.mouseEvent){u.splice(u.indexOf(x),1)}t=z.length;w=true};A.removeAll=function(){t=0;z=[];u=[];w=true};A.sort=function(){z.sort(function(y,x){return(x.z-y.z)});w=true};A.collide=function(y){var x;for(var F=t,G;F--,G=z[F];){if(G.visible&&G.collidable&&G.isEntity){x=G.checkCollision(y);switch(x.type){case A.NO_OBJECT:break;case A.COLLECTABLE_OBJECT:return x;break;case A.ENEMY_OBJECT:return x;break}}}return x};A.repaint=function(){w=true};A.draw=function(){if(w){for(var x=t,y;x--,y=z[x];){if(y.visible){y.draw(spriteCanvasSurface,E,B)}}if(A.HUD!=null){A.HUD.draw(spriteCanvasSurface,E,B)}D.drawImage(spriteCanvasSurface.canvas,E,B);w=false}};return A})();function a(t){if(t==d){return}this.nextState=t;this.actionKey=me.input.KEY.ENTER;this._frameBuffer=null;this.visible=true;this.reset=function(){me.game.reset();me.game.add(this,999);this.onResetEvent();me.game.sort();if(this.actionKey){me.input.bindKey(this.actionKey,"enter")}},this.destroy=function(){this.onDestroyEvent()};this.update=function(){if(this.actionKey&&me.input.isKeyPressed("enter")){me.state.change(this.nextState)}return true};this.onUpdateFrame=function(){me.game.update();me.game.draw();me.video.blitSurface()}}a.prototype.draw=function(t){};a.prototype.onResetEvent=function(){};a.prototype.onDestroyEvent=function(){};var g=(function(){var x={};var u=-1;var t=-1;var v=[null,null,null,null,null,null,null,null,null,];function y(z){if(t==-1){me.timer.reset();t=setInterval(function(){v[z].onUpdateFrame()},~~(1000/me.sys.fps))}}function w(){if(t!=-1){clearInterval(t);t=-1}}x.LOADING=0;x.MENU=1;x.READY=2;x.PLAY=3;x.GAMEOVER=4;x.GAME_END=5;x.SCORE=6;x.init=function(){x.set(x.LOADING,me.loadingScreen);h.addEventListener("blur",function(){if(u!=x.LOADING){x.pause(true)}},false);h.addEventListener("focus",function(){if(u!=x.LOADING){x.resume(true)}},false)};x.pause=function(z){w();if(z){me.audio.pauseTrack()}};x.resume=function(z){y(u);if(z){me.audio.resumeTrack()}};x.set=function(z,A){v[z]=A};x.change=function(z){switch(z){case x.LOADING:case x.MENU:case x.PLAY:case x.GAMEOVER:case x.GAME_END:case x.SCORE:w();if(v[u]){v[u].destroy()}v[z].reset();y(z);u=z;break;default:break}};return x})();h.me.ScreenObject=a;h.me.SpriteObject=q;h.me.AnimatedSpriteObject=j;h.me.state=g;h.me.game=k})(window);(function(d,e){function b(){me.ScreenObject.call(this,me.state.PLAY);this.loadingLogo=null,this.font=new me.Font("Courier",14,"white","top");this.font.bold();this._loadingLogo=new Image();this._loadingLogo.src=me.melonJSLogo;this.setLoadingLogo=function(f){this._loadingLogo=new Image();this._loadingLogo.src=f;console.log(this._loadingLogo)};this.onResetEvent=function(){this.actionKey=null},this.onDestroyEvent=function(){if(this._loadingLogo){this._loadingLogo=null}};this.draw=function(f){var i=f.canvas.height/2;me.video.clearSurface(f,"black");if(this._loadingLogo){f.drawImage(this._loadingLogo,(f.canvas.width-this._loadingLogo.width)/2,(f.canvas.height-this._loadingLogo.height)/2);i+=this._loadingLogo.height/2+20}var g=Math.floor(me.loader.getLoadProgress()*f.canvas.width);f.strokeStyle="silver";f.strokeRect(0,i,f.canvas.width,20);f.fillStyle="gray";f.fillRect(2,i+2,g-4,16);var h=this.font.measure(f,"Loading...");this.font.draw(f,"Loading...",((f.canvas.width-h.width)/2),i+14)}}b.prototype=new me.ScreenObject();var a=(function(){var l={};var h=[];var f=[];var o=0;var j=0;var k=0;function i(){if(j==o){for(var s in f){if(f[s].isTMX){me.levelDirector.addTMXLevel(s)}}if(l.onload){k=setTimeout(l.onload,500)}else{alert("no load callback defined")}}else{k=setTimeout(i,100)}}function m(s){console.log("Failing loading image")}function q(s){h.push(s.name);h[s.name]=new Image();h[s.name].onload=l.onRessourceLoaded.bind(l);h[s.name].onerror=m.bind(this);h[s.name].src=s.src+me.nocache}function g(t,s){if(d.XMLHttpRequest){xmlhttp=new XMLHttpRequest();if(xmlhttp.overrideMimeType){xmlhttp.overrideMimeType("text/xml")}}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",t.src+me.nocache,false);xmlhttp.onload=l.onRessourceLoaded.bind(l);xmlhttp.send();f[t.name]={};f[t.name].xml=xmlhttp.responseText;f[t.name].isTMX=s||false}l.onload=e;l.onRessourceLoaded=function(s){j++};l.preload=function(t){me.audio.setLoadCallback(l.onRessourceLoaded.bind(l));for(var s=0;s<t.length;s++){switch(t[s].type){case"image":q(t[s]);o+=1;break;case"audio":if(me.audio.isAudioEnable()){me.audio.load(t[s]);o+=1}break;case"tmx":g(t[s],true);o+=1;break;default:alert("error : unknow ressource type : %s",t[s].type);break}}i()};l.getXML=function(s){if(f!=null){return f[s].xml}else{return null}};l.getImage=function(s){if(h!=null){return h[s]}else{return null}};l.getLoadProgress=function(){return j/o};return l})();d.me.loader=a;d.me.DefaultLoadingScreen=b})(window);(function(b,d){var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAAAgCAMAAADKUgH/AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMBQTFRFhdQFZZozZqIwg6xZ4+zZN2ILZrMrWIooZqsuVI8JQnIEeaZNKlMEmucwmvEQg8JNe8YTYZobbK0FeLQ3d7FKBSABfL89hcgkersmqfkxl9VLkt4otftS3/+Wbp9AYJ8EjdQfdrkVcKo7T34ma7MEdL4GbKQ+baYWkdtAlN41gcQ4H0QEic5Fs8yZ2ebN9vnzxtmznL177PPm0N/AqcaNvNOmcqhKmt5Nx/pmovsEcK4s///TjLNmZrwp////ZpkzU1rSTAAAAEB0Uk5T////////////////////////////////////////////////////////////////////////////////////AMJ7sUQAAAOOSURBVHjazJhtW7IwFMcdCizAB1QeigLE1FRAyYe6C+H7f6t7A4YDMaW6Lvu/EDbY2Y+z7ZzNRvzH1Lg5AWAYcFMgBiZi0gJ3SMRB8AtAoed5Yu1WBIHCScT8HMiLoij8ARA4FMTcHAgWgQ43B+IOFS66JVDGAcEfA2JIFfxVILRsddue69cDMReBwjBsknsTFU6WdLNYWQB6MAxXVbsLrVduVTKVA4GzQDvf38XmeoXsR68Brg1a+D5q0QMipi9EK8+sAOrZi4HqPry5A9WepFWB7/v4NzrarRwyDsXqRIAAoSb+Nu0NKYhFPzoWaHdkWjVPgGRVfXt8vL+//9dxh24vf1xh6gQoj4kxBURpdWRDBeKNdfKZ6JuTWrEEZKnu0+fT48vcmHc67e5wQh5TpqLm+TjEgQqglheG2VBFq802DBOfbNPXthgn6dzEaH4RaKDO3z+fXHWodruu0ekYKsx9uloHyBQGW38VqZkyUDbG5is24qceCPOuTWSwRZy1IV+bA8GX+/euY4r7/X6433dfOm1nCFKgddqqidFOchkdqkl2zYDy3naopUdoMV3uoHwBiuSVDAjs220HTKeO3tM/HNOcOt15mwHFRYhdL5aBCkTZsJFJTRoGtJUNAULmNsd5R0oEaGE4jq73bLuBpA2cKRgao3HyuCJE0EB5LDrWlIFCGig3iX0f5mpl72edyM8jDaMYtqbZtjFvaNoA9PmrgGLAVeSyi0DNqCwayOr3J8gzi8FA13RdQ1SNyUwWikDBGSDaSfBqoPBLIJnnefDxsZ+i2TNFU8lhZCSpCBRWAJF4yNFjdjVQy6e1o4B4mR+PxzxvJgI8Lo3Hy8tA5dRxqAXknU2uktyXU4hEKR0r1QCCdYFMdN2dz/asIM/wKPG8nF3uBKmOh5i6QDGKi6/ngRSBvUMzuz8aPT/rk1HfsiRpaV4G4r4PtK50EYlDiiSwrHBnybPZzLIs5B52qYBqIAAPp0C1hyxdZse9iOl5hdiiSCxGEoSxgK6sxLIK3ZqyC+kwSAqw9ipLYzbJSyJKlUWgWME0LJEgKPFFIFgM0/XiEPJJug3wPW+T3JWAkI+kDAlflPgyEBOfHDuYGkCxWdw0lYFiZSlJGAZJUuLLQFw5k9EHxWuA8m1tusWpOHUspSWCQuursnUJCGaZjJpT3zhKiwE6zHvbsycfBav2fx+Q4zjy3wPSfwEGALse50AvngzqAAAAAElFTkSuQmCC";b.me.melonJSLogo=a})(window);(function(d,e){function b(f,g){this.x=f||0;this.y=g||0}b.prototype.set=function(f,g){this.x=f;this.y=g};b.prototype.setZero=function(){this.set(0,0)};b.prototype.setV=function(f){this.x=f.x;this.y=f.y};b.prototype.add=function(f){this.x+=f.x;this.y+=f.y};b.prototype.sub=function(f){this.x-=f.x;this.y-=f.y};b.prototype.scale=function(f){this.x*=f.x;this.y*=f.y};b.prototype.negate=function(){return new b(-this.x,-this.y)};b.prototype.div=function(f){this.x/=f;this.y/=f};b.prototype.copy=function(f){this.x=f.x;this.y=f.y};b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};b.prototype.normalize=function(){var f=this.length();this.x/=f;this.y/=f};b.prototype.dotProduct=function(f){return this.x*f.x+this.y*f.y};b.prototype.distance=function(f){return Math.sqrt((this.x-f.x)*(this.x-f.x)+(this.y-f.y)*(this.y-f.y))};b.prototype.clone=function(){return new b(this.x,this.y)};b.prototype.toString=function(){return"x:"+this.x+"y:"+this.y};function a(g,f,i){this.pos=g;this.colPos=new b();this.width=f;this.height=i;this.fWidth=f;this.fHeight=i;this.hWidth=~~(f/2);this.hHeight=~~(i/2);this.tthis=new b();this.trect=new b();this.__defineGetter__("left",function(){return this.pos.x+this.colsPos.x});this.__defineGetter__("right",function(){return this.pos.x+this.colsPos.x+this.width});this.__defineGetter__("top",function(){return this.pos.y+this.colPos.y});this.__defineGetter__("bottom",function(){return this.pos.y+this.colPos.y+this.height})}a.prototype.set=function(g,f,i){this.pos=g;this.width=f;this.height=i;this.fWidth=f;this.fHeight=i;this.hWidth=~~(f/2);this.hHeight=~~(i/2)};a.prototype.adjustSize=function(f,g,j,i){if(f!=0){this.colPos.x=f;this.width=g;this.hWidth=~~(this.width/2)}if(j!=0){this.colPos.y=j;this.height=i;this.hHeight=~~(this.height/2)}};a.prototype.flipX=function(f){this.colPos.x=f-this.width-this.colPos.x;this.hWidth=~~(this.width/2)};a.prototype.flipY=function(f){this.colPos.y=f-this.height-this.colPos.y;this.hHeight=~~(this.height/2)};a.prototype.checkAxisAligned=function(f){this.tthis.x=this.pos.x+this.colPos.x;this.tthis.y=this.pos.y+this.colPos.y;this.trect.x=f.pos.x+f.colPos.x;this.trect.y=f.pos.y+f.colPos.y;return(this.tthis.x<this.trect.x+f.width&&this.trect.x<this.tthis.x+this.width&&this.tthis.y<this.trect.y+f.height&&this.trect.y<this.tthis.y+this.height)};a.prototype.collideVsAABB=function(h){p=new b(0,0);if(this.checkAxisAligned(h)){var g=this.tthis.x+this.hWidth-this.trect.x-h.hWidth;var f=this.tthis.y+this.hHeight-this.trect.y-h.hHeight;p.x=(h.hWidth+this.hWidth)-(g<0?-g:g);p.y=(h.hHeight+this.hHeight)-(f<0?-f:f);if(p.x<p.y){p.y=0;p.x=g<0?-p.x:p.x}else{p.x=0;p.y=f<0?-p.y:p.y}}return p};a.prototype.draw=function(f){f.strokeStyle="red";f.strokeRect(this.pos.x+this.colPos.x-me.game.viewport.pos.x,this.pos.y+this.colPos.y-me.game.viewport.pos.y,this.width,this.height)};d.me.Vector2d=b;d.me.Rectangle=a})(window);(function(a,d){function e(g,h,f,i){this.ALIGN={LEFT:"left",RIGHT:"center",CENTER:"right"};this.set(g,h,f,i)}e.prototype.bold=function(){this.font="bold "+this.font};e.prototype.italic=function(){this.font="italic "+this.font};e.prototype.set=function(g,h,f,i){this.font=""+h+"px "+g;this.height=h;this.color=f;this.align=i||"top"};e.prototype.measure=function(f,g){f.font=this.font;f.fillStyle=this.color;f.textBaseLine=this.align;dim=f.measureText(g);dim.height=this.height;return dim};e.prototype.draw=function(g,h,f,i){g.font=this.font;g.fillStyle=this.color;g.textBaseLine=this.align;g.fillText(h,f,i)};function b(f,g,i,h){e.call(this,f,null,null);this.font=null;if(f){this.size=new me.Vector2d(g,0);this.sSize=new me.Vector2d();this.scale=i||1;this.firstChar=h||32;this.loadFontMetrics(f);this.align=this.ALIGN.RIGHT}}b.prototype=new e();b.prototype.loadFontMetrics=function(f){this.font=me.loader.getImage(f);this.size.y=this.font.height||0;this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale};b.prototype.set=function(g,f){this.align=g;if(f){this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale}};b.prototype.draw=function(h,j,f,k){text=""+j;if(this.align==this.ALIGN.RIGHT){f-=text.length*this.sSize.x}for(var g=0;g<text.length;g++){h.drawImage(this.font,(text.charCodeAt(g)-this.firstChar)*this.size.x,0,this.sSize.x,this.sSize.y,f,k,this.size.x,this.size.y);f+=this.sSize.x}};a.me.Font=e;a.me.BitmapFont=b})(window);(function(b,d){function a(e,h,g,f){me.AnimatedSpriteObject.call(this,e,h,g,f);this.isClickable=true;this.updated=false}a.prototype=new me.AnimatedSpriteObject();a.prototype.update=function(){if(this.updated){this.updated=false;return true}return false};a.prototype.clicked=function(){return false};a.prototype.mouseEvent=function(e,f){if((e>this.pos.x)&&(e<this.pos.x+this.displayWidth)&&(f>this.pos.y)&&(f<this.pos.y+this.displayHeight)){if(this.isClickable){this.updated=this.clicked()}}return this.updated};b.me.GUI_Object=a})(window);(function(d,e){function b(f,h,g){this.pos=new me.Vector2d(f||0,h||0);this.visible=true;this.defaultvalue=g||0;this.value=g||0;this.updated=true}b.prototype.reset=function(){this.value=this.defaultvalue;this.updated=true};b.prototype.update=function(f){this.value+=f;this.updated=true;return this.updated};b.prototype.draw=function(g,f,h){if(this.updated){this.updated=false}};function a(f,k,g,j,i){this.pos=new me.Vector2d(f||0,k||0);this.width=g||me.video.getWidth();this.height=j||me.video.getHeight();this.bgcolor=i;this.HUDItems={};this.HUDobj=[];this.visible=true;this.HUD_invalidated=true;HUDCanvasSurface=me.video.createCanvasSurface(this.width,this.height);this.z=999;this.objCount=0}a.prototype.addItem=function(f,g){this.HUDItems[f]=g;this.HUDobj.push(this.HUDItems[f]);this.objCount++;this.HUD_invalidated=true};a.prototype.updateItemValue=function(f,g){if(this.HUDItems[f]&&(this.HUDItems[f].update(g)==true)){this.HUD_invalidated=true}};a.prototype.getItemValue=function(f){return(this.HUDItems[f])?this.HUDItems[f].value:0};a.prototype.update=function(){return this.HUD_invalidated};a.prototype.reset=function(f){if(this.HUDItems[f]){this.HUDItems[f].reset()}this.HUD_invalidated=true};a.prototype.resetAll=function(){for(var f=this.objCount,g;f--,g=this.HUDobj[f];){g.reset()}this.HUD_invalidated=true};a.prototype.draw=function(h,f,k){if(this.HUD_invalidated){if(this.bgcolor){me.video.clearSurface(HUDCanvasSurface,this.bgcolor)}else{HUDCanvasSurface.canvas.width=HUDCanvasSurface.canvas.width}for(var g=this.objCount,j;g--,j=this.HUDobj[g];){if(j.visible){j.draw(HUDCanvasSurface,f,k)}}}h.drawImage(HUDCanvasSurface.canvas,this.pos.x,this.pos.y);this.HUD_invalidated=false};d.me.HUD_Item=b;d.me.HUD_Object=a})(window);(function(b,d){var a=(function(){var l={};var u=[];var e=["mp3","ogg","wav"];var i=null;var t=-1;var g=null;var o=null;var m=true;function j(){var v=0;if(!me.sys.sound){m=false;return}if((i.search(/mp3/i)!=-1)&&l.capabilities.mp3){return e[v]}if((i.search(/ogg/i)!=-1)&&l.capabilities.ogg){return e[++v]}if((i.search(/wav/i)!=-1)&&l.capabilities.wav){return e[++v]}m=false;return -1}function h(w){var v=u[w];for(var x=0,y;y=v[x++];){if(y.paused||y.ended){y.currentTime=0.01;return y}}v[0].pause();v[0].currentTime=0.01;return v[0]}function q(v){u[v][0].load()}function f(v,x){if(x>1){var w=u[v][0];w.pause();w.currentTime=0.01;for(channel=1;channel<x;channel++){u[v][channel]=w.cloneNode(true)}}if(g){g()}}function s(w,v,y){var x=h(w);x.loop=v;x.play();if(y&&!v){x.addEventListener("ended",function(z){x.removeEventListener("ended",arguments.callee,false);y()},false)}}function k(w,v,x){if(x&&!v){setTimeout(x,2000)}}l.capabilities={mp3:false,ogg:false,ma4:false,wav:false,};l.init=function(v){if(v){i=new String(v)}else{i=new String("mp3")}t=j();if(m){l.play=s}else{l.play=k}return m};l.setLoadCallback=function(v){g=v};l.isAudioEnable=function(){return m};l.load=function(w){if(t==-1){return 0}var v=new Audio(w.src+w.name+"."+t+me.nocache);v.addEventListener("canplaythrough",function(x){v.removeEventListener("canplaythrough",arguments.callee,false);f(w.name,w.channel)},false);v.addEventListener("error",function(x){q(w.name)});v.load();u[w.name]=[v];return 1};l.stop=function(v){if(m){var w=u[v];for(channel_id=w.length;channel_id--;){w[channel_id].pause();w[channel_id].currentTime=0.01}}};l.pause=function(v){if(m){var w=u[v];for(channel_id=w.length;channel_id--;){w[channel_id].pause()}}};l.playTrack=function(v){if(m){if(o!=null){l.stopTrack()}o=h(v);o.loop=true;o.play()}};l.stopTrack=function(){if(m&&o){o.pause();o=null}};l.pauseTrack=function(){if(m&&o){o.pause()}};l.resumeTrack=function(){if(m&&o){o.play()}};return l})();b.me.audio=a})(window);(function(d,e){var a=(function(){var j={};var s=null;var f=false;var k=0;var l=0;var h=0;var q=0;var g=0;var o=0;var i=Math.ceil(1000/me.sys.fps);var t=(1000/me.sys.fps)*1.25;function m(){s.replaceChild(document.createTextNode("("+h+"/"+me.sys.fps+" fps)"),s.firstChild)}j.tick=1;j.init=function(){s=document.getElementById("framecounter");f=(s!==null);j.reset()};j.reset=function(){g=q=new Date().getTime();l=0;k=0};j.getTime=function(){return g};j.update=function(){q=g;g=new Date().getTime();o=(g-q);if(f){k++;l+=o;if(k%10==0){h=Math.ceil((1000*k)/l);m();l=0;k=0}}j.tick=(o>t&&me.sys.interpolation)?o/i:1};return j})();var b=(function(){var i={};var h=null;var l=null;var m=null;var k=null;var g=null;var o=false;var j=0;var f=0;i.init=function(t,v,s,q,u){o=q;me.sys.scale=o===true?u:1;j=v*me.sys.scale;f=s*me.sys.scale;g=document.getElementById(t);h=document.createElement("canvas");h.setAttribute("width",(j)+"px");h.setAttribute("height",(f)+"px");h.setAttribute("border","0px solid black");g.appendChild(h);if(h.getContext){l=h.getContext("2d");if(o){k=i.createCanvasSurface(v,s);m=k.canvas}else{k=l;m=l.canvas}}else{return false}return true};i.getWrapper=function(){return g};i.getWidth=function(){return m.width};i.getHeight=function(){return m.height};i.createCanvasSurface=function(s,q){var t=document.createElement("canvas");t.width=s;t.height=q;return t.getContext("2d")};i.getScreenCanvas=function(){return h};i.getScreenFrameBuffer=function(){return k};i.updateDisplaySize=function(q){if(o){if(q){me.sys.scale=q}else{me.sys.scale=document.getElementById("screen size").value}j=m.width*me.sys.scale;f=m.height*me.sys.scale;h.width=j;h.height=f}};i.clearSurface=function(s,q){s.fillStyle=q;s.fillRect(0,0,s.canvas.width,s.canvas.height)};i.scale=function(q,s){q.translate(-(((q.canvas.width*s)-q.canvas.width)>>1),-(((q.canvas.height*s)-q.canvas.height)>>1));q.scale(s,s)};i.setAlpha=function(s,q){s.globalCompositeOperation=q?"source-over":"copy"};i.blitSurface=function(){if(o){i.blitSurface=function(){l.drawImage(m,0,0,m.width,m.height,0,0,j,f)}}else{i.blitSurface=function(){}}i.blitSurface()};return i})();d.me.timer=a;d.me.video=b})(window);(function(b,d){var a=(function(){var j={};var h=[];var m=[];var s=[];var f=[];var i=null;var l=null;var q=false;function t(v){if(v){if(!q){b.addEventListener("keydown",g,false);b.addEventListener("keyup",e,false)}}else{b.removeEventListener("keydown",g,false);b.removeEventListener("keyup",e,false)}q=v}function o(v){v.preventDefault();if(v.stopPropagation){v.stopPropagation()}v.cancelBubble=true}function g(v){var w=h[v.keyCode];if(w){if(!f[w]){m[w]=true;f[w]=s[w]}o(v)}}function e(v){var w=h[v.keyCode];if(w){m[w]=false;f[w]=false;o(v)}}function k(w){var v=w.clientX-me.video.getScreenCanvas().offsetLeft;var z=w.clientY-me.video.getScreenCanvas().offsetTop;i(v,z)}function u(v){}j.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,PAUSE:19,ESC:27,SPACE:32,CTRL:17,X:88};j.isKeyPressed=function(v){if(m[v]){if(s[v]){f[v]=true;m[v]=false;return true}return true}return false};j.keyStatus=function(v){return(f[v]==true)?true:m[v]};j.bindKey=function(v,x,w){if(!q){t(true)}h[v]=x;s[x]=w?w:false;f[x]=false};j.unbindKey=function(v){m[h[v]]=false;s[h[v]]=false;h[v]=null};j.enableMouseEvent=function(v,w){if(v){me.video.getScreenCanvas().addEventListener("click",k,false);i=w}else{me.video.getScreenCanvas().removeEventListener("click",k,false)}};j.enableGyroscopicEvent=function(v,w){if(b.sys.gyro){b.ondevicemotion=v?u:null;l=v?w:null}};return j})();b.me.input=a})(window);(function(b,d){var a=(function(){var g={};var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var h=null;function e(){if(h==null){h={};for(var j=0;j<f.length;j++){h[f[j]]=j}}}g.decodeNumBase64=function(i){e();i=i.replace(new RegExp("[^"+f.join("")+"=]","g"),"");p=(i.charAt(i.length-1)=="="?(i.charAt(i.length-2)=="="?"AA":"A"):"");r=[];i=i.substr(0,i.length-p.length)+p;for(c=0;c<i.length;c+=4){n=(h[i.charAt(c)]<<18)+(h[i.charAt(c+1)]<<12)+(h[i.charAt(c+2)]<<6)+h[i.charAt(c+3)];r.push((n>>>16)&255);r.push((n>>>8)&255);r.push(n&255)}return r};g.setNocache=function(i){me.nocache=i?"?"+parseInt(Math.random()*10000000):""};g.random=function(j,i){return(~~(Math.random()*(i-j+1))+j)};g.round=function(i,k){var j=Math.pow(10,k);return(Math.round(i*j)/j)};return g})();b.me.utils=a})(window);(function(d,f){var a=Math.min,e=Math.max;function b(g,j,i,h){me.Rectangle.call(this,new me.Vector2d(g,j),i-g,h-j);this.limits=new me.Vector2d(this.width,this.height);this.deadzone=new me.Vector2d(this.width/3,this.height/3)}b.prototype=new me.Rectangle();b.prototype.reset=function(g,h){this.pos.x=g||0;this.pos.y=h||0};b.prototype.setBounds=function(g,h){this.limits.set(g,h)};b.prototype.follow=function(g){if((g.x-this.pos.x)>(this.width-this.deadzone.x)){this.pos.x=a(g.x-(this.width-this.deadzone.x),this.limits.x-this.width)}else{if((g.x-this.pos.x)<(this.deadzone.x)){this.pos.x=e(g.x-this.deadzone.x,0)}}if((g.y-this.pos.y)>(this.height-this.deadzone.y)){this.pos.y=a(g.y-(this.height-this.deadzone.y),this.limits.y-this.height)}else{if((g.y-this.pos.y)<(this.deadzone.y)){this.pos.y=e(g.y-this.deadzone.y,0)}}};b.prototype.followH=function(g){if((g.x-this.pos.x)>(this.width-this.deadzone.x)){this.pos.x=a(g.x-(this.width-this.deadzone.x),this.limits.x-this.width)}else{if((g.x-this.pos.x)<(this.deadzone.x)){this.pos.x=e(g.x-this.deadzone.x,0)}}};b.prototype.followV=function(g){if((g.y-this.pos.y)>(this.height-this.deadzone.y)){this.pos.y=a(g.y-(this.height-this.deadzone.y),this.limits.y-this.height)}else{if((g.y-this.pos.y)<(this.deadzone.y)){this.pos.y=e(g.y-this.deadzone.y,0)}}};b.prototype.move=function(g,h){newx=this.pos.x+g;newy=this.pos.y+h;if((newx>=0)&&(newx<=this.limits.x-this.width)){this.pos.x=newx}if((newy>=0)&&(newy<=this.limits.y-this.height)){this.pos.y=newy}};b.prototype.getWidth=function(){return this.width};b.prototype.getHeight=function(){return this.height};b.prototype.getCenterX=function(){return this.width*0.5};b.prototype.getCenterY=function(){return this.height*0.5};b.prototype.setCenter=function(j,i){var h=j-this.getCenterX();var g=i-this.getCenterY();this.pos.x+=h;this.pos.y+=g};b.prototype.offsetCenter=function(g,h){this.setCenter(this.getCenterX()+g,this.getCenterY()+h)};d.me.Viewport=b})(window);(function(f,b){var j=Math.min;EntityPool=(function(){var l={};var k={};l.init=function(){k.levelentity=me.levelEntity};l.add=function(o,m){k[o]=m};l.newIstanceOf=function(m){if(!k[m.name]){alert("cannot instance entity of type '"+m.name+"': Class not found!");return null}return new k[m.name](m.x,m.y,m)};return l})();function i(k,m,l){if(!k){return}me.SpriteObject.call(this,0,0,me.loader.getImage(k));this.name="parallaxLayerEntity";this.lastx=0;this.startx=0;this.z=l||0;this.scrollspeed=m;this.visible=true;this.vp=me.game.viewport}i.prototype=new me.SpriteObject();i.prototype.addLayer=function(k,l){};i.prototype.draw=function(l,k,o){var m;k=this.vp.pos.x-k;if((me.input.isKeyPressed("right"))&&(this.lastx!=k)){this.startx+=this.scrollspeed*me.timer.tick;if(this.startx>this.spriteWidth){this.startx=this.scrollspeed*me.timer.tick}this.lastx=k}else{if((me.input.isKeyPressed("left"))&&(this.lastx!=k)){this.startx-=this.scrollspeed*me.timer.tick;if(this.startx<0){this.startx=this.spriteWidth-(this.scrollspeed*me.timer.tick)}this.lastx=k}}this.drawParallax(l,k,o)};i.prototype.drawParallax=function(q,k,t){var s=0;var o=0;var m=j(this.spriteWidth-this.startx,this.vp.width);var l=this.startx;do{if(m!=0){q.drawImage(this.image,l,0,m,this.spriteHeight,o,t,m,this.spriteHeight)}s+=m;o+=m;l=0;m=j(this.spriteWidth,this.vp.width-m)}while(s<this.vp.width)};function g(k,o,m,l){if(m==b){return}this.anim=[];this.resetAnim=null;this.current=null;me.AnimatedSpriteObject.call(this,k,o,m,l);if(this.image.width==l){this.update=function(){return false}}else{this.addAnimation("default",null);this.setCurrentAnimation("default")}}g.prototype=new me.AnimatedSpriteObject();g.prototype.addAnimation=function(l,o){this.anim[l]={name:null,frame:[],idx:0,length:0};if(o==null){for(var m=0;m<this.spritecount;m++){this.anim[l].frame[m]=m*this.spriteWidth}}else{var k=0;for(var m=0;m<o.length;m++){this.anim[l].frame[k]=o[m]*this.spriteWidth;k++}}this.anim[l].name=l;this.anim[l].length=this.anim[l].frame.length};g.prototype.setCurrentAnimation=function(k,l){this.current=this.anim[k];this.resetAnim=l||null;this.currentSpriteOff=this.current.frame[this.current.idx]};g.prototype.isCurrentAnimation=function(k){return(this.current.name==k)};g.prototype.setCurrentSprite=function(k){this.current.idx=k;this.currentSpriteOff=this.current.frame[k]};g.prototype.update=function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++this.current.idx<this.current.length?this.current.idx:0);if((this.current.idx==0)&&this.resetAnim){this.setCurrentAnimation(this.resetAnim)}this.fpscount=0;return true}return false};function d(k,o,m,l){if(k==b){return}g.call(this,k,o,me.loader.getImage(m),l);this.pos.set(k,o-this.spriteHeight);this.vel=new me.Vector2d();this.accel=new me.Vector2d();this.gravity=0.98;this.isEntity=true;this.falling=false;this.jumping=false;this.jumpspeed=0;this.slopeaddy=0;this.onslope=false;this.onladder=false;this.collidable=false;this.collectable=false;this.flickering=false;this.flickerTimer=-1;this.flickercb=null;this.collisionMap=me.game.collisionMap}d.prototype=new g();d.prototype.setVelocity=function(k,l){this.accel.x=(k!=0)?k:this.accel.x;this.accel.y=(k!=0)?l:this.accel.y};d.prototype.doWalk=function(k){this.flipX(k);this.vel.x=(k)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick};d.prototype.doClimb=function(k){if(this.onladder){this.vel.y=(k)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick;return true}return false};d.prototype.doJump=function(){if(!this.jumping&&!this.falling){this.jumpspeed=this.accel.y;this.jumping=true;if(this.onslope){this.pos.y+=this.slopeaddy}return true}return false};d.prototype.forceJump=function(){this.jumping=false;this.falling=false;this.doJump()};d.prototype.checkSlope=function(k){this.vel.y=(this.falling)?k.tile.pos.y-this.pos.y-this.displayHeight:0;this.slopeaddy=this.pos.x+this.collisionBox.colPos.x+this.vel.x+this.collisionBox.hWidth-k.tile.pos.x;if(k.yprop.isLeftSlope||k.xprop.isLeftSlope){this.slopeaddy=k.tile.height-this.slopeaddy;this.vel.y+=this.slopeaddy}else{if(k.yprop.isRightSlope||k.xprop.isRightSlope){this.vel.y+=this.slopeaddy}}};d.prototype.updateMovement=function(){if(this.jumping){this.jumpspeed-=this.gravity;if((this.jumpspeed<0)){this.jumping=false;this.falling=true;this.vel.y=0}else{this.vel.y=-this.jumpspeed}}else{if(!this.onladder){this.falling=true;this.vel.y+=this.gravity*me.timer.tick}}var k=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onladder=k.xprop.isLadder;this.onslope=k.yprop.isSlope||k.xprop.isSlope;if(k.y){if(this.vel.y>0){if(k.yprop.isSlope){if(this.falling){this.checkSlope(k);console.log("yslope");this.falling=false;this.jumping=false}}else{if(k.yprop.isSolid||(k.yprop.isPlatform&&(this.pos.y+this.displayHeight<=k.tile.pos.y))){this.vel.y=(this.falling)?k.tile.pos.y-this.pos.y-this.displayHeight:0;this.falling=false;this.jumping=false}}}else{if(this.vel.y<0){if(!k.yprop.isPlatform&&!k.yprop.isLadder){this.jumping=false;this.falling=true;this.vel.y=0}}}}if(k.x){if(this.onslope){if(!k.yprop.isSlope){if(!this.jumping||this.falling){this.checkSlope(k);console.log("xslope");this.falling=false;this.jumping=false}}}else{if(!k.xprop.isPlatform&&!k.xprop.isLadder){this.vel.x=0}}}this.updateFlickering();if((this.vel.x!=0)||(this.vel.y!=0)){this.pos.add(this.vel);if((this.onslope&&!this.jumping)||this.onladder){this.vel.y=0}return true}return false};d.prototype.updateFlickering=function(){if(this.flickering){this.flickerTimer-=1;if(this.flickerTimer<0){if(this.flickercb){this.flickercb()}this.flicker(-1)}else{this.visible=!this.visible}}};d.prototype.flicker=function(k,l){this.flickerTimer=k;if(this.flickerTimer<0){this.flickering=false;this.visible=true;this.flickercb=null}else{if(!this.flickering){this.flickercb=l;this.flickering=true}}};function e(k,o,m,l){d.call(this,k,o,m,l);this.collisionEnable=true;this.collidable=true;this.type=me.game.COLLECTABLE_OBJECT}e.prototype=new d();function h(l,o,m,k){d.call(this,l,o,b);this.pos=new me.Vector2d(l,o);this.collisionBox=new me.Rectangle(this.pos,m,k);this.collidable=true;this.isEntity=true;this.visible=true}h.prototype=new d();h.prototype.draw=function(k){if(me.debug.renderHitBox){this.collisionBox.draw(k)}};h.prototype.update=function(){return false};function a(l,q,m,k,o){h.call(this,l,q,m,k);this.nextlevel=o}a.prototype=new h();a.prototype.goTo=function(l){var k=l||this.nextlevel;me.levelDirector.loadLevel(k)};a.prototype.onCollision=function(){this.goTo()};f.me.entityPool=EntityPool;f.me.ParallaxEntity=i;f.me.ObjectEntity=d;f.me.CollectableEntity=e;f.me.invisibleEntity=h;f.me.levelEntity=a})(window);(function(g,e){removepath=/^.*(\\|\/|\:)/;removeext=/\.[^\.]*$/;var b={COLLISION_MAP:"collision",PARALLAX_MAP:"parallax",};function i(k,q,l,m,o){me.Rectangle.call(this,new me.Vector2d(k*l,q*m),l,m);this.tileId=o;this.row=k;this.col=q}i.prototype=new me.Rectangle();function j(m,o,l,s,q,k){this.name=m;this.tilewidth=o;this.tileheight=l;this.spacing=s;this.margin=q;this.image=(k)?me.loader.getImage(k.replace(removepath,"").replace(removeext,"")):null;this.type={SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder"};this.TileProperties=[];if(this.image){this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing));this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))}}j.prototype.getPropertyList=function(){return{isCollectable:false,isCollidable:false,isSolid:false,isPlatform:false,isSlope:false,isLeftSlope:false,isRightSlope:false,isLadder:false}};j.prototype.getTileProperties=function(k){return this.TileProperties[k]};j.prototype.isTileCollidable=function(k){return this.TileProperties[k].isCollidable};j.prototype.isTileCollectable=function(k){return this.TileProperties[k].isCollectable};j.prototype.drawTile=function(l,k,s,q){var o=this.margin+(this.spacing+this.tilewidth)*(q%this.hTileCount);var m=this.margin+(this.spacing+this.tileheight)*~~(q/this.hTileCount);l.drawImage(this.image,o,m,this.tilewidth,this.tileheight,k,s,this.tilewidth,this.tileheight)};function h(k,l){this.realwidth=k;this.realheight=l;this.isCollisionMap=true}h.prototype.checkCollision=function(o,l){var k=(l.x<0)?o.pos.x+o.colPos.x+l.x:o.pos.x+o.colPos.x+o.width+l.x-1;var q=(l.y<0)?o.pos.y+o.colPos.y+l.y:o.pos.y+o.colPos.y+o.height+l.y;var m={x:false,y:false,tile:e,xprop:{},yprop:{}};if(k<=0||k>=this.realwidth){m.x=true}if(q<=0||q>=this.realheight){m.y=true}return m};function d(k,l,m,o){this.width=k;this.height=l;this.z=o;this.name=null;this.visible=false;this.layerData=null;this.xLUT={};this.yLUT={};this.tileset=m;if(m){this.tilewidth=m.tilewidth;this.tileheight=m.tileheight}else{this.tilewidth=0;this.tileheight=0}this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight}d.prototype.initArray=function(l){this.layerData=new Array(this.width);for(var k=0;k<this.width+1;k++){this.layerData[k]=new Array(this.height);for(var m=0;m<this.height+1;m++){this.layerData[k][m]=e}}if(l){for(var k=0;k<this.width*this.tilewidth;k++){this.xLUT[k]=~~(k/this.tilewidth)}for(var m=0;m<this.height*this.tileheight;m++){this.yLUT[m]=~~(m/this.tileheight)}}};d.prototype.getTileId=function(k,m){var l=this.layerData[this.xLUT[~~k]][this.yLUT[~~m]];return l?l.tileId:null};d.prototype.getTile=function(k,l){return this.layerData[this.xLUT[~~k]][this.yLUT[~~l]]};d.prototype.setTile=function(k,m,l){this.layerData[k][m]=new i(k,m,this.tilewidth,this.tileheight,l)};d.prototype.checkCollision=function(q,m){var k=(m.x<0)?q.pos.x+q.colPos.x+m.x:q.pos.x+q.colPos.x+q.width+m.x-1;var s=(m.y<0)?q.pos.y+q.colPos.y+m.y:q.pos.y+q.colPos.y+q.height+m.y;var o={x:false,y:false,tile:e,xprop:{},yprop:{}};var l;if(k<=0||k>=this.realwidth){o.x=true}else{l=this.getTile(k,q.pos.y+q.colPos.y+q.height-1);if(l&&this.tileset.isTileCollidable(l.tileId)){o.x=true;o.tile=l;o.xprop=this.tileset.getTileProperties(l.tileId)}else{l=this.getTile(k,q.pos.y+q.colPos.y);if(l&&this.tileset.isTileCollidable(l.tileId)){o.x=true;o.tile=l;o.xprop=this.tileset.getTileProperties(l.tileId)}}}l=this.getTile(q.pos.x+q.colPos.x,s);if(l&&this.tileset.isTileCollidable(l.tileId)){o.y=true;o.tile=l;o.yprop=this.tileset.getTileProperties(l.tileId)}else{l=this.getTile(q.pos.x+q.colPos.x+q.width-1,s);if(l&&this.tileset.isTileCollidable(l.tileId)){o.y=true;o.tile=l;o.yprop=this.tileset.getTileProperties(l.tileId)}}return o};d.prototype.update=function(){return false};function f(k,l){this.pos=new me.Vector2d(k,l);this.z=0;this.width=0;this.height=0;this.realwidth=-1;this.realheight=-1;this.tilewidth=0;this.tileheight=0;this.tileset=[];this.mapLayers=[];this.objectGroups=[]}f.prototype.getObjectGroupByName=function(k){return this.objectGroups[k]};f.prototype.getObjectGroups=function(){return this.objectGroups};f.prototype.getLayerByName=function(k){var m=null;k=k.trim().toLowerCase();for(var l=this.mapLayers.length;l--;){if(this.mapLayers[l].name.contains(k)){m=this.mapLayers[l];break}}if((k.contains(b.COLLISION_MAP))&&(m==null)){m=new h(me.game.currentLevel.realwidth,me.game.currentLevel.realheight)}return m};f.prototype.addTo=function(k){if(this.visible){k.add(this)}for(var l=this.mapLayers.length;l--;){if(this.mapLayers[l].visible){k.add(this.mapLayers[l])}}};f.prototype.update=function(){return false};var a=(function(){var m={};var k={};var l=0;m.reset=function(){};m.addLevel=function(o){console.log("no level loader defined")};m.addTMXLevel=function(o,q){if(k[o]==null){k[o]=new me.TMXTileMap(o,0,0)}if(q){q()}};m.loadLevel=function(o){if(k[o]===e){console.log("level %s not found",o);return}if(k[o] instanceof me.TMXTileMap){me.state.pause();me.game.reset();k[o].load();l=o;me.game.loadTMXLevel(k[l]);me.state.resume()}else{console.log("no level loader defined")}};m.reloadLevel=function(){return m.loadLevel(l)},m.nextLevel=function(){if(l+1<k.length){return m.loadLevel(l+1)}else{return false}};m.previousLevel=function(){if(l-1>=0){return m.loadLevel(l-1)}else{return false}};m.goToLevel=function(o){m.loadLevel(o)};return m})();g.me.Tile=i;g.me.TileSet=j;g.me.TiledLayer=d;g.me.TileMap=f;g.me.LevelConstants=b;g.me.levelDirector=a})(window);(function(f,d){function k(m){m=(m.charAt(0)=="#")?m.substring(1,7):m;rgb="rgb("+parseInt(m.substring(0,2),16);rgb+=","+parseInt(m.substring(2,4),16);rgb+=","+parseInt(m.substring(4,6),16)+")";return rgb}var j={TAG_MAP:"map",TAG_NAME:"name",TAG_VALUE:"value",TAG_VERSION:"version",TAG_ORIENTATION:"orientation",TAG_WIDTH:"width",TAG_HEIGHT:"height",TAG_OPACITY:"opacity",TAG_TILEWIDTH:"tilewidth",TAG_TILEHEIGHT:"tileheight",TAG_FIRSTGID:"firstgid",TAG_GID:"gid",TAG_TILE:"tile",TAG_ID:"id",TAG_DATA:"data",TAG_COMPRESSION:"compression",TAG_ENCODING:"encoding",TAG_ATTR_BASE64:"base64",TAG_SPACING:"spacing",TAG_MARGIN:"margin",TAG_PROPERTIES:"properties",TAG_PROPERTY:"property",TAG_IMAGE:"image",TAG_SOURCE:"source",TAG_VISIBLE:"visible",TAG_TILESET:"tileset",TAG_LAYER:"layer",TAG_OBJECTGROUP:"objectgroup",TAG_OBJECT:"object",TAG_X:"x",TAG_Y:"y",TAG_WIDTH:"width",TAG_HEIGHT:"height",};function g(t,s){var o=s.getElementsByTagName(j.TAG_PROPERTIES)[0];if(o){var m=o.getElementsByTagName(j.TAG_PROPERTY);for(var q=0;q<m.length;q++){h(t,m[q])}}}function h(m,s){var q=me.XMLParser.getStringAttribute(s,j.TAG_NAME);var o=me.XMLParser.getStringAttribute(s,j.TAG_VALUE);if(!o||o.isBoolean()){o=o?(o=="true"):true}else{if(o.isNumeric()){o=parseInt(o)}}m[q]=o}function e(o,m,q){me.TileMap.call(this,m,q);this.xmlMap=me.loader.getXML(o);if(!this.xmlMap){alert(o+" map not found");return}this.version="";this.orientation="";this.tileMapCanvas=null;this.initialized=false}e.prototype=new me.TileMap();e.prototype.load=function(){if(this.initialized){return}var u=0;var w=1;me.XMLParser.parseFromString(this.xmlMap);var x=me.XMLParser.getAllTagElements();for(var v=0;v<x.length;v++){var s=x.item(v).nodeName;switch(s){case j.TAG_MAP:var o=x.item(v);this.version=me.XMLParser.getStringAttribute(o,j.TAG_VERSION);this.orientation=me.XMLParser.getStringAttribute(o,j.TAG_ORIENTATION);this.width=me.XMLParser.getIntAttribute(o,j.TAG_WIDTH);this.height=me.XMLParser.getIntAttribute(o,j.TAG_HEIGHT);this.tilewidth=me.XMLParser.getIntAttribute(o,j.TAG_TILEWIDTH);this.tileheight=me.XMLParser.getIntAttribute(o,j.TAG_TILEHEIGHT);this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight;this.z=u++;if(this.orientation!="orthogonal"){alert("%s type tilemap not supported!",this.orientation);return}g(this,o);if(this.background_color){this.visible=true;this.background_color=k(this.background_color)}else{this.visible=false}break;case j.TAG_TILESET:this.tileset.push(new b(x.item(v)));break;case j.TAG_LAYER:var q=me.XMLParser.getStringAttribute(x.item(v),j.TAG_NAME);if(q.contains(me.LevelConstants.COLLISION_MAP)){this.mapLayers.push(new a(x.item(v),this.tileset,u++))}else{if(q.contains(me.LevelConstants.PARALLAX_MAP)){var t=(me.XMLParser.getIntAttribute(x.item(v),j.TAG_VISIBLE,1)==1);if(t){var y={};g(y,x.item(v));this.mapLayers.push(new me.ParallaxEntity(y.imagesrc,w++,u++));u++}}else{this.mapLayers.push(new a(x.item(v),this.tileset,u++))}}break;case j.TAG_OBJECTGROUP:var m=me.XMLParser.getStringAttribute(x.item(v),j.TAG_NAME);this.objectGroups.push(new l(m,x.item(v),u++));break}}me.XMLParser.free();this.initialized=true};e.prototype.draw=function(m){me.video.clearSurface(m,this.background_color)};function b(q){this.firstgid=me.XMLParser.getIntAttribute(q,j.TAG_FIRSTGID);me.TileSet.call(this,me.XMLParser.getStringAttribute(q,j.TAG_NAME),me.XMLParser.getIntAttribute(q,j.TAG_TILEWIDTH),me.XMLParser.getIntAttribute(q,j.TAG_TILEHEIGHT),me.XMLParser.getIntAttribute(q,j.TAG_SPACING,0),me.XMLParser.getIntAttribute(q,j.TAG_MARGIN,0),q.getElementsByTagName(j.TAG_IMAGE)[0].getAttribute(j.TAG_SOURCE));var m=q.getElementsByTagName(j.TAG_TILE);for(var s=0;s<m.length;s++){var t=me.XMLParser.getIntAttribute(m[s],j.TAG_ID);var o=this.getPropertyList();g(o,m[s]);o.isSolid=o.type?o.type.toLowerCase()==this.type.SOLID:false;o.isPlatform=o.type?o.type.toLowerCase()==this.type.PLATFORM:false;o.isLeftSlope=o.type?o.type.toLowerCase()==this.type.L_SLOPE:false;o.isRightSlope=o.type?o.type.toLowerCase()==this.type.R_SLOPE:false;o.isLadder=o.type?o.type.toLowerCase()==this.type.LADDER:false;o.isSlope=o.isLeftSlope||o.isRightSlope;o.isCollidable=o.isSolid||o.isPlatform||o.isSlope||o.isLadder;this.TileProperties[t]=o}}b.prototype=new me.TileSet();function a(o,u,s){me.TiledLayer.call(this,me.XMLParser.getIntAttribute(o,j.TAG_WIDTH),me.XMLParser.getIntAttribute(o,j.TAG_HEIGHT),u[0],s);this.layerInvalidated=true;this.name=me.XMLParser.getStringAttribute(o,j.TAG_NAME);this.visible=(me.XMLParser.getIntAttribute(o,j.TAG_VISIBLE,1)==1);this.opacity=me.XMLParser.getFloatAttribute(o,j.TAG_OPACITY,1);g(this,o);this.isCollisionMap=(this.name.contains(me.LevelConstants.COLLISION_MAP));if(this.isCollisionMap){this.visible=false;if(u[1]){this.tileset=u[1]}}this.vp=me.game.viewport;var t=o.getElementsByTagName(j.TAG_DATA)[0];var q=me.XMLParser.getStringAttribute(t,j.TAG_ENCODING);var m=me.XMLParser.getStringAttribute(t,j.TAG_COMPRESSION);if(this.visible||this.isCollisionMap){this.layerSurface=me.video.createCanvasSurface(this.width*this.tilewidth,this.height*this.tileheight);this.layerCanvas=this.layerSurface.canvas;if(this.opacity>0&&this.opacity<1){this.layerSurface.globalAlpha=this.opacity}this.initArray(this.isCollisionMap);this.fillArray(t,q,m)}}a.prototype=new me.TiledLayer();a.prototype.fillArray=function(v,t,q){if(q!=null){alert(q+" compressed tilemap not supported!");return}if(t==j.TAG_ATTR_BASE64){var u=me.utils.decodeNumBase64(v.childNodes[0].nodeValue)}else{var u=v.getElementsByTagName(j.TAG_TILE)}var o=0;for(var w=0;w<this.height;w++){for(var m=0;m<this.width;m++){if(t==j.TAG_ATTR_BASE64){var s=u[o]|u[o+1]<<8|u[o+2]<<16|u[o+3]<<24;o+=4}else{var s=me.XMLParser.getIntAttribute(u[o++],j.TAG_GID)}if(s>0){this.setTile(m,w,s-this.tileset.firstgid);if(this.visible){this.tileset.drawTile(this.layerSurface,m*this.tilewidth,w*this.tileheight,this.layerData[m][w].tileId)}}else{}}}};a.prototype.draw=function(o,m,q){o.drawImage(this.layerCanvas,this.vp.pos.x,this.vp.pos.y,this.vp.width,this.vp.height,m,q,this.vp.width,this.vp.height)};function l(o,m,t){this.objects=[];this.name=o;this.width=me.XMLParser.getIntAttribute(m,j.TAG_WIDTH);this.height=me.XMLParser.getIntAttribute(m,j.TAG_HEIGHT);this.z=t;var s=m.getElementsByTagName(j.TAG_OBJECT);for(var q=0;q<s.length;q++){this.objects.push(new i(s[q],t))}}l.prototype.getObjectCount=function(){return this.objects.length};l.prototype.getObjectByIndex=function(m){return this.objects[m]};function i(m,o){this.name=me.XMLParser.getStringAttribute(m,j.TAG_NAME);this.x=me.XMLParser.getIntAttribute(m,j.TAG_X);this.y=me.XMLParser.getIntAttribute(m,j.TAG_Y);this.z=o;this.width=me.XMLParser.getIntAttribute(m,j.TAG_WIDTH,0);this.height=me.XMLParser.getIntAttribute(m,j.TAG_HEIGHT,0);g(this,m)}i.prototype.getObjectPropertyByName=function(m){return this[m]};f.me.TMXTileMap=e})(window);
/*!
 * Tween JS
 * https://github.com/sole/Tween.js
 *
 * @author sole / http://soledadpenades.com
 * @author mr.doob / http://mrdoob.com
 * @author Robert Eisele / http://www.xarg.org
 * @author Philippe / http://philippe.elsass.me
 * @author Robert Penner / http://www.robertpenner.com/easing_terms_of_use.html
 */
(function(a,b){var d=function(h){var q=h,o={},k={},l={},i=1000,m=0,e=null,s=d.Easing.Linear.EaseNone,g=null,j=null,f=null;this.to=function(t,v){if(v!==null){i=v}for(var u in t){if(q[u]===null){continue}l[u]=t[u]}return this};this.start=function(){e=me.timer.getTime()+m;for(var t in l){if(q[t]===null){continue}o[t]=q[t];k[t]=l[t]-q[t]}return this};this.stop=function(){return this};this.delay=function(t){m=t;return this};this.easing=function(t){s=t;return this};this.chain=function(t){g=t};this.onUpdate=function(t){j=t;return this};this.onComplete=function(t){f=t;return this};this.update=function(){var v,t,u;var w=me.timer.getTime();if(w<e){return true}t=(w-e)/i;t=t>1?1:t;u=s(t);for(v in k){q[v]=o[v]+k[v]*u}if(j!==null){j.call(q,u)}if(t==1){if(f!==null){f.call(q)}if(g!==null){g.start()}return false}return true}};d.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};d.Easing.Linear.EaseNone=function(e){return e};d.Easing.Quadratic.EaseIn=function(e){return e*e};d.Easing.Quadratic.EaseOut=function(e){return -e*(e-2)};d.Easing.Quadratic.EaseInOut=function(e){if((e*=2)<1){return 0.5*e*e}return -0.5*(--e*(e-2)-1)};d.Easing.Cubic.EaseIn=function(e){return e*e*e};d.Easing.Cubic.EaseOut=function(e){return --e*e*e+1};d.Easing.Cubic.EaseInOut=function(e){if((e*=2)<1){return 0.5*e*e*e}return 0.5*((e-=2)*e*e+2)};d.Easing.Quartic.EaseIn=function(e){return e*e*e*e};d.Easing.Quartic.EaseOut=function(e){return -(--e*e*e*e-1)};d.Easing.Quartic.EaseInOut=function(e){if((e*=2)<1){return 0.5*e*e*e*e}return -0.5*((e-=2)*e*e*e-2)};d.Easing.Quintic.EaseIn=function(e){return e*e*e*e*e};d.Easing.Quintic.EaseOut=function(e){return(e=e-1)*e*e*e*e+1};d.Easing.Quintic.EaseInOut=function(e){if((e*=2)<1){return 0.5*e*e*e*e*e}return 0.5*((e-=2)*e*e*e*e+2)};d.Easing.Sinusoidal.EaseIn=function(e){return -Math.cos(e*Math.PI/2)+1};d.Easing.Sinusoidal.EaseOut=function(e){return Math.sin(e*Math.PI/2)};d.Easing.Sinusoidal.EaseInOut=function(e){return -0.5*(Math.cos(Math.PI*e)-1)};d.Easing.Exponential.EaseIn=function(e){return e==0?0:Math.pow(2,10*(e-1))};d.Easing.Exponential.EaseOut=function(e){return e==1?1:-Math.pow(2,-10*e)+1};d.Easing.Exponential.EaseInOut=function(e){if(e==0){return 0}if(e==1){return 1}if((e*=2)<1){return 0.5*Math.pow(2,10*(e-1))}return 0.5*(-Math.pow(2,-10*(e-1))+2)};d.Easing.Circular.EaseIn=function(e){return -(Math.sqrt(1-e*e)-1)};d.Easing.Circular.EaseOut=function(e){return Math.sqrt(1- --e*e)};d.Easing.Circular.EaseInOut=function(e){if((e/=0.5)<1){return -0.5*(Math.sqrt(1-e*e)-1)}return 0.5*(Math.sqrt(1-(e-=2)*e)+1)};d.Easing.Elastic.EaseIn=function(f){var g,e=0.1,h=0.4;if(f==0){return 0}if(f==1){return 1}if(!h){h=0.3}if(!e||e<1){e=1;g=h/4}else{g=h/(2*Math.PI)*Math.asin(1/e)}return -(e*Math.pow(2,10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h))};d.Easing.Elastic.EaseOut=function(f){var g,e=0.1,h=0.4;if(f==0){return 0}if(f==1){return 1}if(!h){h=0.3}if(!e||e<1){e=1;g=h/4}else{g=h/(2*Math.PI)*Math.asin(1/e)}return(e*Math.pow(2,-10*f)*Math.sin((f-g)*(2*Math.PI)/h)+1)};d.Easing.Elastic.EaseInOut=function(f){var g,e=0.1,h=0.4;if(f==0){return 0}if(f==1){return 1}if(!h){h=0.3}if(!e||e<1){e=1;g=h/4}else{g=h/(2*Math.PI)*Math.asin(1/e)}if((f*=2)<1){return -0.5*(e*Math.pow(2,10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h))}return e*Math.pow(2,-10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h)*0.5+1};d.Easing.Back.EaseIn=function(e){var f=1.70158;return e*e*((f+1)*e-f)};d.Easing.Back.EaseOut=function(e){var f=1.70158;return(e=e-1)*e*((f+1)*e+f)+1};d.Easing.Back.EaseInOut=function(e){var f=1.70158*1.525;if((e*=2)<1){return 0.5*(e*e*((f+1)*e-f))}return 0.5*((e-=2)*e*((f+1)*e+f)+2)};d.Easing.Bounce.EaseIn=function(e){return 1-d.Easing.Bounce.EaseOut(1-e)};d.Easing.Bounce.EaseOut=function(e){if((e/=1)<(1/2.75)){return 7.5625*e*e}else{if(e<(2/2.75)){return 7.5625*(e-=(1.5/2.75))*e+0.75}else{if(e<(2.5/2.75)){return 7.5625*(e-=(2.25/2.75))*e+0.9375}else{return 7.5625*(e-=(2.625/2.75))*e+0.984375}}}};d.Easing.Bounce.EaseInOut=function(e){if(e<0.5){return d.Easing.Bounce.EaseIn(e*2)*0.5}return d.Easing.Bounce.EaseOut(e*2-1)*0.5+0.5};a.me.Tween=d})(window);